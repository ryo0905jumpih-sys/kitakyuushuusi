<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—é‡ç«ç½æ°—è±¡æ¡ä»¶ è‡ªå‹•åˆ¤å®šãƒ„ãƒ¼ãƒ«</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <header>
            <h1>æ°—è±¡æ¡ä»¶è‡ªå‹•åˆ¤å®šã‚·ã‚¹ãƒ†ãƒ </h1>
            <p class="subtitle">åŒ—ä¹å·å¸‚æ¶ˆé˜²å±€ å†…éƒ¨åˆ©ç”¨ (å…«å¹¡è¦³æ¸¬æ‰€åŸºæº–)</p>
        </header>

        <main>
            <div id="result-card" class="card result-card loading">
                <h2>æœ¬æ—¥ã®åˆ¤å®šçµæœ</h2>
                <div class="status-display">
                    <span id="status-icon">Checking...</span>
                    <span id="status-text">ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­</span>
                </div>
                <div class="timestamp">æ›´æ–°æ—¥æ™‚: <span id="updated-at">--</span></div>
            </div>

            <div class="details-grid">
                <div class="card detail-card">
                    <h3>é™æ°´é‡ (å…«å¹¡)</h3>
                    <div class="data-row">
                        <span>å‰3æ—¥ (ç¢ºå®šå€¤)</span>
                        <span class="value" id="p3d-val">-- mm</span>
                    </div>
                    <div class="data-row">
                        <span>å‰30æ—¥ (ç¢ºå®šå€¤)</span>
                        <span class="value" id="p30d-val">-- mm</span>
                    </div>
                </div>

                <div class="card detail-card">
                    <h3>æ°—è±¡æ³¨æ„å ± (åŒ—ä¹å·å¸‚)</h3>
                    <div class="data-row">
                        <span>ä¹¾ç‡¥æ³¨æ„å ±</span>
                        <span class="value" id="dry-val">--</span>
                    </div>
                    <div class="data-row">
                        <span>å¼·é¢¨æ³¨æ„å ±</span>
                        <span class="value" id="wind-val">--</span>
                    </div>
                </div>
            </div>

            <div class="notice-box">
                <p><strong>ã€åˆ¤å®šåŸºæº–ã€‘</strong><br>
                    ãƒ»<strong>æ³¨æ„ãƒ¬ãƒ™ãƒ«</strong>: (å‰3æ—¥é›¨é‡â‰¤1mm ã‹ã¤ å‰30æ—¥é›¨é‡â‰¤30mm) ã¾ãŸã¯ (å‰3æ—¥é›¨é‡â‰¤1mm ã‹ã¤ ä¹¾ç‡¥æ³¨æ„å ±ç™ºè¡¨ä¸­)<br>
                    ãƒ»<strong>è­¦å ±ãƒ¬ãƒ™ãƒ«</strong>: æ³¨æ„ãƒ¬ãƒ™ãƒ« ã‹ã¤ å¼·é¢¨æ³¨æ„å ±ï¼ˆé™¸ä¸Šï¼‰ç™ºè¡¨ä¸­
                </p>
                <p class="small">â€»æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯æ°—è±¡åºå…¬å¼ãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«è‡ªå‹•åˆ¤å®šã—ã¦ã„ã¾ã™ãŒã€æœ€çµ‚çš„ãªåˆ¤æ–­ã¯é‹ç”¨ã«å¾“ã£ã¦ãã ã•ã„ã€‚ä½œæˆè€…:ç¢“æœ¨</p>
            </div>
        </main>
    </div>

    <script src="data.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (window.WEATHER_DATA) {
                updateUI(window.WEATHER_DATA);
            } else {
                // Fallback for server environment if data.js not present, or just show error
                fetch('data.json')
                    .then(response => {
                        if (!response.ok) throw new Error("Data not found");
                        return response.json();
                    })
                    .then(data => {
                        updateUI(data);
                    })
                    .catch(error => {
                        console.warn('Fetch error:', error);
                        document.getElementById('status-text').textContent = "ãƒ‡ãƒ¼ã‚¿èª­è¾¼å¤±æ•—(ãƒ­ãƒ¼ã‚«ãƒ«è¦åˆ¶)";
                        document.getElementById('status-icon').textContent = "âŒ";
                    });
            }
        });

        function updateUI(data) {
            const resultCard = document.getElementById('result-card');
            const statusText = document.getElementById('status-text');
            const statusIcon = document.getElementById('status-icon');

            // Update Timestamp
            document.getElementById('updated-at').textContent = data.updated_at;

            // Update Result
            resultCard.classList.remove('loading');
            resultCard.classList.remove('level-0', 'level-1', 'level-2');
            resultCard.classList.add(`level-${data.level}`);

            statusText.textContent = data.result_text;

            if (data.level === 0) {
                statusIcon.textContent = "âœ”";
            } else if (data.level === 1) {
                statusIcon.textContent = "âš ";
            } else if (data.level === 2) {
                statusIcon.textContent = "ğŸš¨";
            }

            // Update Details
            // P3D
            const p3d = parseFloat(data.p3d).toFixed(1);
            document.getElementById('p3d-val').textContent = `${p3d} mm`;
            if (parseFloat(data.p3d) <= 1.0) {
                document.getElementById('p3d-val').classList.add('alert-val');
            }

            // P30D
            const p30d = parseFloat(data.p30d).toFixed(1);
            document.getElementById('p30d-val').textContent = `${p30d} mm`;
            if (parseFloat(data.p30d) <= 30.0) {
                document.getElementById('p30d-val').classList.add('alert-val');
            }

            setBooleanStatus('dry-val', data.is_dry);

            // Wind handling with details
            const windEl = document.getElementById('wind-val');
            windEl.textContent = data.wind_text || (data.is_strong_wind ? "ç™ºè¡¨ä¸­" : "ãªã—");
            if (data.is_strong_wind) {
                windEl.classList.add('active-warning');
            } else {
                windEl.classList.remove('active-warning');
            }
        }

        function setBooleanStatus(id, value) {
            const el = document.getElementById(id);
            if (value) {
                el.textContent = "ç™ºè¡¨ä¸­";
                el.classList.add('active-warning');
            } else {
                el.textContent = "ãªã—";
                el.classList.remove('active-warning');
            }
        }
    </script>
</body>

</html>